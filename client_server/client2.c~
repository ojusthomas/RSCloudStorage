#include<stdio.h>
#include<sys/socket.h>
#include<netinet/in.h>
#include<string.h>

int main()
{
	int clientsocket,enable=1;
	char buffer[1024],filename[40];
	struct sockaddr_in serverAddr;
	socklen_t addr_size;
	
	clientsocket=socket(PF_INET,SOCK_STREAM,0);
	serverAddr.sin_family=AF_INET;
	serverAddr.sin_port = htons(7855);
	serverAddr.sin_addr.s_addr=inet_addr("127.0.0.1");
	memset(serverAddr.sin_zero,'\0',sizeof serverAddr.sin_zero);
	
	if (setsockopt(clientsocket, SOL_SOCKET, SO_REUSEADDR, &enable, sizeof(int)) < 0)
    		error("setsockopt(SO_REUSEADDR) failed");
	//CONNECTION ESTABILSHMENT
	connect(clientsocket,(struct sockaddr*)&serverAddr,sizeof(serverAddr));
	    printf("Connected\n");

	

	FILE *f;
	int bytes_received,n,tmp,num,len;
	
	
	recv(clientsocket, &tmp, sizeof(tmp),0);
	num = ntohl(tmp);
	//printf("\n%d\n",num);
	//while(num>0)
	//{
	
	
	bytes_received=recv(clientsocket,filename,sizeof(filename),0);
	filename[bytes_received]='\0';
	//printf("\n%s\n :-",filename);
	send(clientsocket,"recv",sizeof("recv"),0);

	
	f=fopen(filename,"a+b");
	bytes_received=recv(clientsocket,buffer,sizeof(buffer),0);
	buffer[bytes_received]='\0';
		printf("File : %s has been received\n ",filename);
		//printf("\nFile content :\n %s",buffer);

	fprintf(f,"%s",buffer);

	//n = fwrite(buffer, sizeof(char), sizeof(buffer), f);
	num--;
	fclose(f);
	
	//}

fflush(stdin);
return 0;
}
